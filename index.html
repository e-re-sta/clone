<script>
const gameContent = document.getElementById('gameContainer');
let game1LoopId = null;

function backToMain(){
  // Canvas lÃ¶schen
  gameContent.innerHTML = '';
  // Game Loop stoppen
  if(game1LoopId) cancelAnimationFrame(game1LoopId);
  game1LoopId = null;
}

// ----------------- AGENTBIRD GAME 1 -----------------
function startGame1() {
  backToMain(); // sicherstellen, dass vorheriges Spiel gestoppt ist

  const canvas = document.createElement('canvas');
  canvas.width = 800;
  canvas.height = 500;
  canvas.style.backgroundColor = '#87CEEB';
  gameContent.appendChild(canvas);
  const ctx = canvas.getContext('2d');

  // Back-Button
  const backBtn = document.createElement('button');
  backBtn.className = 'backBtn';
  backBtn.innerText = 'Back';
  backBtn.onclick = backToMain;
  gameContent.appendChild(backBtn);

  // Spieler
  const player = { x:100, y:250, width:40, height:30, color:'orange', shield:0, speed:4 };
  let score = 0;
  let onGround = false;

  const geese=[], bullets=[], planes=[], shots=[], powerups=[], particles=[];
  const groundY = canvas.height-50;
  let shootCooldown=0;

  canvas.addEventListener('touchstart', e=>{e.preventDefault(); movePlayer(e.touches[0].clientY); });
  canvas.addEventListener('touchmove', e=>{e.preventDefault(); movePlayer(e.touches[0].clientY); });
  canvas.addEventListener('mousemove', e=>movePlayer(e.clientY));

  function movePlayer(clientY){
    const y = clientY - canvas.getBoundingClientRect().top - player.height/2;
    player.y = Math.max(0, Math.min(canvas.height - player.height, y));
  }

  canvas.addEventListener('click', shoot);
  canvas.addEventListener('touchend', shoot);
  function shoot(){
    if(shootCooldown<=0){
      shots.push({x:player.x+player.width, y:player.y+player.height/2-2, width:10, height:4, speed:8});
      shootCooldown=20;
    }
  }

  function spawnGeese(){ if(Math.random()<0.01){ geese.push({ x:800, y:Math.random()*400, width:50, height:40, color:'gray', cooldown:100 }); } }
  function spawnPlanes(){ if(Math.random()<0.005){ planes.push({ x:800, y:Math.random()*200+50, width:80, height:40, color:'black', speed:2 }); } }
  function spawnPowerups(){ if(Math.random()<0.002){ const type = Math.random()<0.5?'shield':'speed'; powerups.push({ x:800, y:Math.random()*400, width:20, height:20, type, speed:2 }); } }
  function spawnWeather(){
    if(Math.random()<0.05) particles.push({ x:Math.random()*800, y:0, speed:Math.random()*3+1, type:'snow' });
    if(Math.random()<0.02) particles.push({ x:Math.random()*800, y:0, speed:Math.random()*5+2, type:'rain' });
    if(Math.random()<0.001) particles.push({ x:Math.random()*800, y:Math.random()*200, type:'lightning', life:10 });
  }

  function collide(a,b){ return a.x<a.x+a.width && b.x<b.x+b.width && a.y<a.y+a.height && b.y<b.y+b.height; }

  function update(){
    if(shootCooldown>0) shootCooldown--;

    if(player.y + player.height >= groundY){
      player.y = groundY - player.height;
      onGround = true;
      score += 1;
    } else { onGround = false; }

    if(!onGround){
      geese.forEach((g,i)=>{
        g.x -=2; g.cooldown--;
        if(g.cooldown<=0){ bullets.push({ x:g.x, y:g.y+20, speed:5 }); g.cooldown=100; }
        if(g.x+g.width<0) geese.splice(i,1);
      });

      bullets.forEach((b,i)=>{
        b.x -= b.speed;
        if(collide(player,b)){ if(player.shield>0){player.shield--; bullets.splice(i,1);} else{ alert("Getroffen! Spiel endet."); backToMain(); } }
        if(b.x<0) bullets.splice(i,1);
      });

      planes.forEach((p,i)=>{
        p.x -= p.speed;
        if(collide(player,p)){ if(player.shield>0){player.shield--; planes.splice(i,1);} else{ alert("Getroffen! Spiel endet."); backToMain(); } }
        if(p.x+p.width<0) planes.splice(i,1);
      });
    }

    shots.forEach((s,i)=>{
      s.x += s.speed;
      geese.forEach((g,gi)=>{ if(collide(s,g)){ geese.splice(gi,1); shots.splice(i,1); score+=10; } });
      planes.forEach((p,pi)=>{ if(collide(s,p)){ planes.splice(pi,1); shots.splice(i,1); score+=20; } });
      if(s.x>canvas.width) shots.splice(i,1);
    });

    powerups.forEach((p,i)=>{
      p.x -= p.speed;
      if(collide(player,p)){
        if(p.type==='shield') player.shield+=3;
        if(p.type==='speed'){ player.speed=8; setTimeout(()=>{player.speed=4;},5000); }
        powerups.splice(i,1);
      }
      if(p.x+p.width<0) powerups.splice(i,1);
    });

    particles.forEach((p,i)=>{
      if(p.type==='snow' || p.type==='rain') p.y+=p.speed;
      if(p.type==='lightning') p.life--;
      if(p.y>canvas.height || p.life<=0) particles.splice(i,1);
    });

    spawnGeese(); spawnPlanes(); spawnWeather(); spawnPowerups();

    score +=0.05;
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle='#87CEEB';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#228B22';
    ctx.fillRect(0,groundY,canvas.width,canvas.height-groundY);

    ctx.fillStyle=player.color;
    ctx.fillRect(player.x,player.y,player.width,player.height);

    geese.forEach(g=>{ ctx.fillStyle=g.color; ctx.fillRect(g.x,g.y,g.width,g.height); });
    planes.forEach(p=>{ ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.width,p.height); });
    bullets.forEach(b=>{ ctx.fillStyle='black'; ctx.fillRect(b.x,b.y,5,5); });
    shots.forEach(s=>{ ctx.fillStyle='red'; ctx.fillRect(s.x,s.y,s.width,s.height); });

    powerups.forEach(p=>{
      ctx.fillStyle=p.type==='shield'?'cyan':'yellow';
      ctx.fillRect(p.x,p.y,p.width,p.height);
    });

    particles.forEach(p=>{
      if(p.type==='snow'){ ctx.fillStyle='white'; ctx.fillRect(p.x,p.y,4,4); }
      else if(p.type==='rain'){ ctx.fillStyle='blue'; ctx.fillRect(p.x,p.y,2,8); }
      else if(p.type==='lightning'){ ctx.strokeStyle='yellow'; ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(p.x+5,p.y+20); ctx.stroke(); }
    });

    ctx.fillStyle='black';
    ctx.font='20px Arial';
    ctx.fillText('Score: '+Math.floor(score),10,30);
    ctx.fillText('Shield: '+player.sh
